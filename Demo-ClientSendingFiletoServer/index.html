<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload & Download</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: auto; }
        input, button { margin: 10px; padding: 10px; }
        ul { list-style: none; padding: 0; }
        li { margin: 10px 0; }
        a { text-decoration: none; color: blue; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üìÇ Upload & Download Files</h2>

        <!-- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå -->
        <input type="file" id="fileInput" onchange="previewFile()">
        <button onclick="uploadFile()">Upload</button>
        <p id="uploadStatus"></p>
        
        <!--h2>üìÇ Preview File Before Upload</h2>
        <div id="preview" style="width: auto; height: auto;"></div!-->

        <h3>üìú Files on Server</h3>
        <ul id="fileList"></ul>
    </div>

    <script>
        const serverUrl = 'http://localhost:8100';
        /*
        function previewFile() {
            const file = document.getElementById('fileInput').files[0];
            const preview = document.getElementById('preview');
            preview.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°

            if (!file) return;

            const reader = new FileReader();

            // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û
            if (file.type.startsWith('image/')) {
                reader.onload = function (e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            } 
            // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            else if (file.type === 'text/plain' || file.type === 'application/json') {
                reader.onload = function (e) {
                    const pre = document.createElement('pre');
                    pre.textContent = e.target.result;
                    preview.appendChild(pre);
                };
                reader.readAsText(file);
            } 
            // ‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            else {
                const p = document.createElement('p');
                p.textContent = `Selected file: ${file.name}`;
                preview.appendChild(p);
            }
        }
        */
        // üìå ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
        function uploadFile() {
            const fileInput = document.getElementById('fileInput').files[0];
            if (!fileInput) return alert('Please select a file');

            const formData = new FormData();
            formData.append('file', fileInput);

            fetch(`${serverUrl}/upload`, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('uploadStatus').textContent = data.message;
                    loadFileList(); // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
                })
                .catch(error => console.error('Upload error:', error));
        }

        // üìå ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
        function loadFileList() {
            fetch(`${serverUrl}/files`)
                .then(response => response.json())
                .then(files => {
                    const fileList = document.getElementById('fileList');
                    fileList.innerHTML = '';
                    files.forEach(file => {
                        const li = document.createElement('li');
                        li.innerHTML = `<a href="${serverUrl}/download/${file}" download>${file}</a>`;
                        fileList.appendChild(li);
                    });
                })
                .catch(error => console.error('Error loading file list:', error));
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
        loadFileList();
    </script>
</body>
</html>
